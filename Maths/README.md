# 概率论

## 生日问题

### 最小人数同生日

一个队列，从前往后，第一个符合条件的人获得奖励。条件：你是第一个和前面的人有相同生日的人。

前 $k-1 $ 个人生日各不相同的概率为：$P_{\text{unique}}(k-1) = \frac{365}{365} \times \frac{364}{365} \times \frac{363}{365} \times \dots \times \frac{(365-k+2)}{365}$

可以化简为：$P_{\text{unique}}(k-1) = \frac{365!}{(365-k+1)!} \times \frac{1}{365^{(k-1)}}$

第$ k $个人生日与他们相同的概率为：$P_{\text{match}}(k) = \frac{k-1}{365}$

需要计算的概率为：$P_{\text{win}}(k) = P_{\text{unique}}(k-1) \times P_{\text{match}}(k)$

使这个概率最大即可。可编程绘图实现，或求导。

## 骰子设计

### 非标准骰模拟标准骰和分布

两个标准骰子的和的分布服从2-12给定。请设计两个非标准骰子，每一面都是正整数，且和的概率分布和两个标准骰子一样，并证明。（就是也是2: $\frac{1}{36}$, 3: $\frac{2}{36}$, 4: $\frac{3}{36}$ ……）

两个标准骰子（6 面，1-6）的和的分布如下：

| Sum  | Ways to Get                              | Probability |
| ---- | ---------------------------------------- | ----------- |
| 2    | (1,1)                                    | 1/36        |
| 3    | (1,2), (2,1)                             | 2/36        |
| 4    | (1,3), (2,2), (3,1)                      | 3/36        |
| 5    | (1,4), (2,3), (3,2), (4,1)               | 4/36        |
| 6    | (1,5), (2,4), (3,3), (4,2), (5,1)        | 5/36        |
| 7    | (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) | 6/36        |
| 8    | (2,6), (3,5), (4,4), (5,3), (6,2)        | 5/36        |
| 9    | (3,6), (4,5), (5,4), (6,3)               | 4/36        |
| 10   | (4,6), (5,5), (6,4)                      | 3/36        |
| 11   | (5,6), (6,5)                             | 2/36        |
| 12   | (6,6)                                    | 1/36        |

Sicherman在 1978 年做了个著名发现：

$$(x + x^2 + x^3 + x^4 + x^5 + x^6)^2 \quad=\quad \underbrace{(\,x + x^3 + x^4 + x^5 + x^6 + x^8\,)}_{\displaystyle A(x)} \;\times\; \underbrace{(\,x + 2x^2 + 2x^3 + x^4\,)}_{\displaystyle B(x)}.$$

由此可见，这正是一对“非标准”的骰子：

- 第一颗：1, 3, 4, 5, 6, 8（6 个面都互不相同），
- 第二颗：1, 2, 2, 3, 3, 4（6 个面中有些数字重复出现）。

**为什么它是“唯一的”？**

直觉上，“在形式多项式里做因式分解”往往只有有限几种办法，再结合要求“各多项式只含 6 项、系数为非负整数”这几点限制，就可以证明只有两种可能：

1. 就是 $(x + x^2 + \cdots + x^6)\times(x + x^2 + \cdots + x^6)$（对应标准骰子本身）；
2. 就是上面提到的  $(x + x^3 + x^4 + x^5 + x^6 + x^8)\times(x + 2x^2 + 2x^3 + x^4)$（对应 Sicherman 骰子）。

它们掷出的点数和在 $2\le S\le 12$区间的概率分布恰与标准骰子相同。

### 用一个骰子设计游戏使甲以指定概率赢

用一个骰子，设计一个游戏，使得甲获胜的概率是$\frac{7}{13}$。只有甲和乙两个玩家。

乙获胜的概率是6/13，则可以设计游戏，投掷两次求和，使得乙以12/36的概率获胜，甲以14/36的概率获胜，另外10/36的概率重新再投掷骰子。

能否优化？使得投掷的期望次数减少呢？

可以另投掷到1或者2，判定乙获胜。投掷到3或者4，判定甲获胜。如果投掷到5，再次投掷，再次投掷到1或者2，则甲获胜，否则重新投掷。投掷到6，重新投掷。

这样也符合12/36,14/36和10/36的分布，但是期望次数减少了。

### 三次骰子期望收益

骰子 骰到几，给几块钱。最多骰三次。每次投掷完，如果选择收手，那么拿钱走人。如果选择继续，那么就再投一次，但是上一次不会获得钱，并且以下一次的点数为准。求游戏的期望获利。

设 `E_n` 为在第 `n` 次投掷时的期望收益：

**第三次投掷（必须收手）**：  $E_3 = \frac{1+2+3+4+5+6}{6} = 3.5 $ 

**第二次投掷**：   $ E_2 = \frac{1}{6} \sum_{x=1}^{6} \max(x, E_3) $    计算：  $E_2 = \frac{3.5 + 3.5 + 3.5 + 4 + 5 + 6}{6} = \frac{25.5}{6} \approx 4.25   $ 

**第一次投掷**： $ E_1 = \frac{1}{6} \sum_{x=1}^{6} \max(x, E_2)   $  计算：   $  E_1 = \frac{4.25 + 4.25 + 4.25 + 4.25 + 5 + 6}{6} = \frac{28}{6} \approx 4.67$ 

因此，该游戏的**期望收益为**：$   \mathbf{E_1 \approx 4.67} $

## 圆周问题

### 一个圆上随机三点锐角三角形概率

第一个点是0弧度，第二个点和第一个点之间圆心角夹角为a，二三点之间夹角为b，第三个点和第一个点夹角为c。a+b+c=2π, 并且a，b，c需要能够组成一个三角形，abc不能有任意一个角大于π，否则就是钝角三角形了。转化成了一个木棍摔成三段，三段能够组成三角形。答案是$\dfrac14$.

# 数理统计

## 假设检验

### 样本量怎么估算

**提前问自己**：“我想要的提升（δ）多大？能不能检测出来？”

给定你能接受的错误率 α 和 β，最小可检测差值 δ， **你要保证：你观测到的 δ 足够大，大到在 H₀ 和 H₁ 的分布中能被区分开来**

我们假设两种情况下的差值分布：

1. under **H₀**（无提升）：

   $\Delta \sim N(0, \text{SE}^2)$

2. under **H₁**（有提升 δ）：

   $\Delta \sim N(\delta, \text{SE}^2)$

你希望：

- Z 值在 H₀ 下落在 α 的拒绝域；
- 同时，在 H₁ 下也有 1−β 的概率能落入拒绝域 ⇒ 保证检验有足够功效。

这就等价于：

$\frac{\delta}{\text{SE}} \ge Z_{1 - \alpha/2} + Z_{1 - \beta}$

 就是说，两分布之间的**均值差**（δ）至少要超过它们波动范围的“误差带”。

最终总结公式: $\frac{\delta}{\sqrt{ \frac{p_1(1 - p_1)}{n_1} + \frac{p_2(1 - p_2)}{n_2} }} \ge Z_{1 - \alpha/2} + Z_{1 - \beta}$

可以从这推导出 n₁, n₂ 的需求，从而设计实验。

### 不同用户群体间，连续变量是否有差异(ANOVA)

不同用户群体（比如男性 vs 女性 vs 新用户）之间，**某个连续型指标（比如留存率、时长、消费金额）有没有显著差异？**

使用ANOVA方差分析，看多组均值是否有显著差异

假设我们有 kkk 个组，每组样本量 nin_ini，样本总数 NNN。

总体思想是：**组间方差是否显著大于组内方差**？

**1. 组间均值平方和（Between-group variance）：**
$$
SS_{\text{between}} = \sum_{i=1}^{k} n_i (\bar{y}_i - \bar{y})^2
$$
**2. 组内均方（Within-group variance）：**
$$
SS_{\text{within}} = \sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij} - \bar{y}_i)^2
$$
**3. F值：**
$$
F = \frac{MS_{\text{between}}}{MS_{\text{within}}} = \frac{SS_{\text{between}}/(k - 1)}{SS_{\text{within}}/(N - k)}
$$


如果 F 值很大，说明组间差异显著 ⇒ 拒绝原假设（组均值相等）

ANOVA 的核心思想是对比组间方差与组内方差，从而判断组别对指标是否有显著影响

# 金融数学

## 夏普比率与收益率转化

年月的转换和月收益率的标准差和均值

夏普比率（Sharpe Ratio）是量化金融中的一个核心指标，它衡量的是单位风险（标准差）下的超额收益。计算公式如下：

$Sharpe Ratio = \frac{E[R_p] - R_f}{\sigma_p}$

其中：

- $E[R_p]$ 是投资组合的预期收益率（通常使用历史平均收益率）。
- $R_f$ 是无风险收益率（如国债收益率）。
- $\sigma_p$ 是投资组合收益率的标准差。

在量化面试中，可能会涉及到时间频率转换，例如：

1. **月收益率转换成年化收益率**

   $Annualized Return = (1 + Monthly Return)^{12} - 1$

   或者直接用均值：

   $Annualized Return = Mean(Monthly Returns) \times 12$

2. **月标准差转换成年化标准差**

   $Annualized Volatility = Monthly Volatility \times \sqrt{12}$

- 如果无风险收益率是年化的，则需要转换为月度： $Monthly Risk-Free Rate = (1 + R_f)^{\frac{1}{12}} - 1$
- 计算超额收益率，即每个月的收益减去无风险收益率。



